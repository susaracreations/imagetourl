<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instant Image Uploader (ImgBB)</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configure Inter font and custom colors -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f9; /* Soft, professional background */
        }
        /* Custom scrollbar for better feel */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #e0e7ff;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #1e40af; /* Darker blue thumb */
            border-radius: 10px;
        }
        /* Custom class for drag-over state - professional blue glow effect */
        .drag-over {
            border: 3px dashed #3b82f6; /* Blue-500 */
            background-color: #eff6ff; /* Blue-50 */
            box-shadow: 0 0 0 4px #bfdbfe; /* Blue-200 outline */
        }
    </style>
</head>
<body class="min-h-screen flex justify-center p-10">

    <!-- Main Application Container: Clean white card with strong shadow -->
    <div id="appContainer" class="w-full max-w-4xl bg-white shadow-2xl rounded-xl p-10 space-y-8 transition duration-300">
        
        <header class="space-y-2">
            <h1 class="text-4xl font-extrabold text-gray-800 text-center">
                üåê Image URL QuickLink
            </h1>
            <p class="text-center text-gray-500 text-lg">
                Upload via **Drag & Drop**, **Paste** from clipboard, or **Select** files. Get instant, public image URLs.
            </p>
        </header>

        <!-- Drop Zone/File Input Area -->
        <div id="dropZone" class="flex flex-col space-y-6 p-8 border-2 border-dashed border-gray-300 rounded-xl transition duration-300 hover:border-blue-500">
            
            <!-- Icon and main instruction -->
            <div class="flex flex-col items-center justify-center space-y-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-blue-500" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd" />
                </svg>
                <p class="text-center text-xl font-semibold text-gray-700">
                    Drop your images here, or click to select
                </p>
            </div>
            
            <div class="flex items-center justify-center space-x-2">
                <div class="h-px w-1/4 bg-gray-200"></div>
                <span class="text-gray-400 font-medium">OR</span>
                <div class="h-px w-1/4 bg-gray-200"></div>
            </div>

            <!-- Custom styled file input -->
            <input type="file" id="imageInput" accept="image/*" multiple class="
                w-full text-sm text-gray-500 mt-4
                file:mr-4 file:py-3 file:px-6
                file:rounded-full file:border-0
                file:text-base file:font-bold
                file:bg-blue-100 file:text-blue-700
                hover:file:bg-blue-200
                cursor-pointer
            ">
            <button id="uploadButton" onclick="uploadImage()" class="
                w-full py-4 px-4 
                bg-blue-600 hover:bg-blue-700 
                text-white font-extrabold text-lg
                rounded-xl shadow-lg hover:shadow-xl
                transition duration-200 ease-in-out
                disabled:opacity-40 disabled:shadow-none disabled:cursor-not-allowed
                tracking-wider
            " disabled>
                üöÄ UPLOAD & GET LINKS
            </button>
        </div>

        <!-- Status/Loading Area -->
        <div id="statusMessage" class="min-h-[2.5rem] text-center text-base font-medium">
            <!-- Messages will appear here (e.g., Loading, Success, Error) -->
        </div>

        <!-- Results Area - Clean, separated section for uploaded images -->
        <div id="resultsArea" class="hidden space-y-6 pt-6 border-t border-gray-100">
            <h2 id="resultsTitle" class="text-2xl font-bold text-gray-700">Successful Uploads</h2>
            <div id="resultsContainer" class="space-y-4 max-h-[70vh] overflow-y-auto pr-3">
                <!-- Individual image result cards will be dynamically inserted here -->
            </div>
        </div>

    </div>

    <script>
        // ImgBB API Key provided by the user
        const IMGBB_API_KEY = "9e45c2a61b049286d6230275e700a932";
        const API_URL = "https://api.imgbb.com/1/upload";

        // DOM elements
        const imageInput = document.getElementById('imageInput');
        const uploadButton = document.getElementById('uploadButton');
        const statusMessage = document.getElementById('statusMessage');
        const resultsArea = document.getElementById('resultsArea');
        const resultsContainer = document.getElementById('resultsContainer');
        const dropZone = document.getElementById('dropZone');

        // --- COMMON FILE INJECTION LOGIC ---

        /**
         * Centralized function to inject files into the input, update the UI, and provide feedback.
         * @param {File[]} files - An array of image File objects.
         * @param {string} source - 'Pasted' or 'Dropped'.
         */
        function injectFilesToInput(files, source) {
            let imageFiles = files.filter(file => file.type.startsWith('image/'));

            if (imageFiles.length === 0) {
                statusMessage.className = 'text-center text-red-600 font-medium';
                statusMessage.textContent = `No valid images found in the ${source} content.`;
                return;
            }
            
            // Create a DataTransfer object to hold the new file list
            const dataTransfer = new DataTransfer();
            imageFiles.forEach(file => dataTransfer.items.add(file));
            
            // Set the new file list on the input element
            imageInput.files = dataTransfer.files;

            // Display user feedback
            statusMessage.className = 'text-center text-blue-600 font-medium';
            statusMessage.textContent = `${source} ${imageFiles.length} image(s) loaded. Ready to upload.`;

            // Manually trigger the 'change' event to update UI and enable button
            imageInput.dispatchEvent(new Event('change'));
        }

        // --- DRAG AND DROP FUNCTIONALITY START ---

        // Attach drag listeners to the dedicated drop zone
        dropZone.addEventListener('dragenter', handleDragEnter);
        dropZone.addEventListener('dragover', handleDragOver);
        dropZone.addEventListener('dragleave', handleDragLeave);
        dropZone.addEventListener('drop', handleDrop);

        function handleDragEnter(event) {
            event.preventDefault(); 
            dropZone.classList.add('drag-over');
        }

        function handleDragOver(event) {
            event.preventDefault(); 
            dropZone.classList.add('drag-over');
            event.dataTransfer.dropEffect = 'copy';
        }

        function handleDragLeave(event) {
            // Check if the related target is outside the dropZone element
            if (event.relatedTarget && !dropZone.contains(event.relatedTarget)) {
                dropZone.classList.remove('drag-over');
            }
        }

        function handleDrop(event) {
            event.preventDefault();
            dropZone.classList.remove('drag-over');

            const files = Array.from(event.dataTransfer.files);
            
            if (files.length > 0) {
                injectFilesToInput(files, 'Dropped');
            } else {
                 statusMessage.className = 'text-center text-red-600 font-medium';
                 statusMessage.textContent = 'Could not process dropped item.';
            }
        }
        // --- DRAG AND DROP FUNCTIONALITY END ---


        // --- PASTE FUNCTIONALITY START ---
        document.addEventListener('paste', handlePaste);

        /**
         * Handles paste events, checks for image data in the clipboard, and updates the file input.
         */
        function handlePaste(event) {
            const items = (event.clipboardData || event.originalEvent.clipboardData).items;
            let filesFromPaste = [];

            for (const item of items) {
                if (item.kind === 'file' && item.type.startsWith('image/')) {
                    const file = item.getAsFile();
                    if (file) {
                        filesFromPaste.push(file);
                    }
                }
            }

            if (filesFromPaste.length > 0) {
                event.preventDefault();
                injectFilesToInput(filesFromPaste, 'Pasted');
            }
        }
        // --- PASTE FUNCTIONALITY END ---


        // Event listener to enable the upload button when files are selected
        imageInput.addEventListener('change', () => {
            uploadButton.disabled = !imageInput.files.length;
            // Clear previous results/messages on new file selection
            statusMessage.textContent = '';
            resultsArea.classList.add('hidden');
            resultsContainer.innerHTML = '';
        });

        /**
         * Converts the selected image file to a Base64 encoded string.
         * @param {File} file - The image file object.
         * @returns {Promise<string>} - A promise that resolves with the Base64 string (without the MIME prefix).
         */
        const fileToBase64 = (file) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => {
                    // Extract the base64 part (remove "data:image/jpeg;base64,")
                    const base64String = reader.result.split(',')[1];
                    resolve(base64String);
                };
                reader.onerror = (error) => reject(error);
                reader.readAsDataURL(file);
            });
        };

        /**
         * Retries a fetch request using exponential backoff.
         */
        const fetchWithRetry = async (url, options, maxRetries = 3, delay = 1000) => {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response;
                } catch (error) {
                    if (i === maxRetries - 1) {
                        throw error;
                    }
                    await new Promise(resolve => setTimeout(resolve, delay * Math.pow(2, i)));
                }
            }
        };

        /**
         * Creates and displays an individual result card for a successfully uploaded image.
         */
        const displayResult = (imageUrl, fileName) => {
            const cardHtml = `
                <!-- Professional result card design -->
                <div class="flex items-center p-4 bg-white border border-gray-200 rounded-xl shadow-md space-x-4">
                    
                    <!-- Preview Image -->
                    <div class="flex-shrink-0 w-24 h-24 overflow-hidden rounded-lg bg-gray-100 border border-gray-300">
                        <img src="${imageUrl}" alt="Preview of ${fileName}" class="w-full h-full object-contain">
                    </div>

                    <!-- File Info and URL -->
                    <div class="flex-grow space-y-1 min-w-0">
                        <p class="text-sm font-semibold text-gray-800 truncate" title="${fileName}">
                            File: ${fileName}
                        </p>
                        
                        <!-- URL Input Field -->
                        <div class="flex items-stretch">
                            <input type="text" value="${imageUrl}" readonly
                                class="flex-grow p-2 border border-green-300 rounded-l-lg bg-green-50 text-green-800 text-xs font-mono overflow-hidden whitespace-nowrap focus:outline-none focus:ring-2 focus:ring-green-400"
                                onclick="this.select()">
                            <button onclick="copyUrl('${imageUrl}', this)" class="
                                p-2 bg-green-600 hover:bg-green-700 
                                text-white font-semibold text-sm
                                rounded-r-lg shadow-md 
                                transition duration-150 ease-in-out
                                flex items-center copy-btn
                                min-w-[70px]
                            ">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                            </button>
                        </div>
                    </div>
                </div>
            `;

            resultsContainer.innerHTML += cardHtml;
            resultsArea.classList.remove('hidden');
        };


        /**
         * Main function to handle image upload to ImgBB (now handles multiple files sequentially).
         */
        async function uploadImage() {
            const files = imageInput.files;

            if (files.length === 0) {
                statusMessage.className = 'text-center text-red-600 font-medium';
                statusMessage.textContent = 'Please select or drop at least one image file.';
                return;
            }

            // Clear previous results
            resultsContainer.innerHTML = '';
            resultsArea.classList.add('hidden');
            uploadButton.disabled = true;

            let successfulUploads = 0;
            let failedUploads = 0;

            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const fileNumber = i + 1;
                const totalFiles = files.length;

                // Show loading state for the current file
                statusMessage.className = 'text-center text-blue-600 font-medium animate-pulse';
                statusMessage.textContent = `Processing ${fileNumber} of ${totalFiles}: Uploading "${file.name}"...`;

                // Basic validation
                if (!file.type.startsWith('image/')) {
                    statusMessage.textContent = `Skipped file ${file.name}: Invalid file type.`;
                    failedUploads++;
                    continue;
                }

                try {
                    const base64Image = await fileToBase64(file);

                    const formData = new FormData();
                    formData.append('key', IMGBB_API_KEY);
                    formData.append('image', base64Image); 

                    const response = await fetchWithRetry(API_URL, {
                        method: 'POST',
                        body: formData
                    });

                    const result = await response.json();

                    if (result.success) {
                        const imageUrl = result.data.url;
                        displayResult(imageUrl, file.name);
                        successfulUploads++;
                    } else {
                        console.error(`ImgBB API Error for ${file.name}:`, result.error ? result.error.message : 'Unknown ImgBB API error.');
                        failedUploads++;
                    }
                    
                } catch (error) {
                    console.error(`Upload Error for ${file.name}:`, error);
                    failedUploads++;
                }
            }
            
            // Final status update
            uploadButton.disabled = false;
            
            if (successfulUploads > 0) {
                statusMessage.className = 'text-center text-green-600 font-bold';
                statusMessage.textContent = `üéâ Upload Complete! ${successfulUploads} file(s) uploaded successfully. ${failedUploads > 0 ? `(${failedUploads} failed)` : ''}`;
            } else {
                statusMessage.className = 'text-center text-red-600 font-bold';
                statusMessage.textContent = `‚ùå Upload Failed. No files were successfully uploaded.`;
            }

            // Clear file input to allow re-uploading the same files if needed
            imageInput.value = '';
        }

        /**
         * Copies the provided URL to the clipboard.
         */
        function copyUrl(url, buttonElement) {
            const tempInput = document.createElement('input');
            tempInput.value = url;
            document.body.appendChild(tempInput);
            
            try {
                tempInput.select();
                tempInput.setSelectionRange(0, 99999); 
                document.execCommand('copy');
                
                // Provide visual feedback
                buttonElement.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 13.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg> Copied!';
                buttonElement.classList.replace('bg-green-600', 'bg-green-800');

                setTimeout(() => {
                    buttonElement.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>';
                    buttonElement.classList.replace('bg-green-800', 'bg-green-600');
                }, 2000);

            } catch (err) {
                console.error('Failed to copy text: ', err);
                statusMessage.className = 'text-center text-red-600 font-medium';
                statusMessage.textContent = 'Copy failed.';
            } finally {
                document.body.removeChild(tempInput);
            }
        }
    </script>
</body>
</html>
